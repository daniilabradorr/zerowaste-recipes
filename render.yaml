services:
  - type: web
    name: zerowaste-recipes
    env: python
    plan: free

    # Instalamos dependencias
    buildCommand: |
      cd zerowaste-recipes 
      pip install -r requirements.txt
      python manage.py collectstatic --noinput --clear --verbosity 2 || exit 1 

    # Aplicamos migraciones antes de recoger est√°ticos
    preDeployCommand: |
      python manage.py migrate --noinput

    # Arrancamos Gunicorn en el puerto asignado por Render
    startCommand: |
      gunicorn zerowaste.wsgi \
        --workers 3 \
        --bind 0.0.0.0:$PORT \
        --log-file -

    # Opcional: health check
    healthCheckPath: "/"
    healthCheckIntervalSeconds: 15