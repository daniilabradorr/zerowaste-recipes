services:
  - type: web
    name: zerowaste-recipes
    env: python
    plan: free

    # ---------- BUILD ----------
    # 1) Instala dependencias
    # 2) Ejecuta collectstatic durante el build
    buildCommand: |
      pip install -r requirements.txt
      python manage.py collectstatic --noinput --clear --verbosity 2 || exit 1

    # ---------- PRE-DEPLOY ----------
    # Sólo migraciones (los estáticos ya se recogieron arriba)
    preDeployCommand: |
      python manage.py migrate --noinput

    # ---------- START ----------
    startCommand: |
      gunicorn zerowaste.wsgi \
        --workers 3 \
        --bind 0.0.0.0:$PORT \
        --log-file -

    # Opcional: health-check sencillo
    healthCheckPath: "/"
    healthCheckIntervalSeconds: 15
